# Task Management System

A modern task management microservice built with Spring Boot, PostgreSQL, and Redis, following Domain-Driven Design (DDD) principles. Designed for deployment on Azure Container Apps with Docker containerization.

## 🏗️ Architecture

![Task Management System Architecture](./assets/architecture-diagram.svg)

### Tech Stack
- **Backend**: Spring Boot 3.5.5 with Java 21
- **Database**: PostgreSQL (UUID primary keys)
- **Cache**: Redis with advanced caching strategies
- **Messaging**: Apache Kafka for event-driven architecture
- **Containerization**: Docker & Docker Compose
- **Deployment**: Azure Container Apps
- **Build Tool**: Maven

### Design Principles
- **Domain-Driven Design**: Clean architecture with separated layers
- **Relational Model**: PostgreSQL with UUID primary keys
- **Microservices Ready**: Stateless, containerized, and cloud-native

## 📋 Features

- ✅ Create, update, and manage tasks
- ✅ Board-based task organization
- ✅ Task assignment and status tracking
- ✅ Priority management
- ✅ Overdue task detection
- ✅ Advanced Redis caching with multiple strategies
- ✅ Cache performance monitoring and metrics
- ✅ Cache management APIs
- ✅ Apache Kafka event-driven messaging
- ✅ Real-time task event publishing
- ✅ Notification system with Kafka
- ✅ Analytics and monitoring integration
- ✅ Health checks and monitoring
- ✅ Docker containerization
- ✅ Cloud deployment ready

## 🚀 Quick Start

### Prerequisites
- Java 21
- Maven 3.6+
- Docker & Docker Compose
- Git

### Local Development Setup

1. **Clone the repository**
   ```bash
   git clone <your-repo-url>
   cd app
   ```

2. **Start infrastructure with Docker**
   ```bash
   docker-compose up -d mongodb redis
   ```

3. **Run the application locally**
   ```bash
   mvn spring-boot:run
   ```

4. **Access the application**
   - API: http://localhost:8081
   - Health Check: http://localhost:8081/actuator/health

### Full Docker Deployment

1. **Build and start everything**
   ```bash
   docker-compose up --build
   ```

2. **Run in background**
   ```bash
   docker-compose up -d --build
   ```

3. **View logs**
   ```bash
   docker-compose logs -f app
   ```

4. **Stop services**
   ```bash
   docker-compose down
   ```

## 📁 Project Structure

```
app/
├── src/
│   ├── main/
│   │   ├── java/com/company/app/
│   │   │   ├── application/
│   │   │   │   ├── dto/           # Data Transfer Objects
│   │   │   │   └── service/       # Application Services
│   │   │   ├── domain/
│   │   │   │   ├── entity/        # Domain Entities
│   │   │   │   ├── repository/    # Repository Interfaces
│   │   │   │   └── valueobject/   # Value Objects
│   │   │   ├── infrastructure/    # External concerns
│   │   │   └── presentation/      # Controllers
│   │   └── resources/
│   │       ├── application.properties    # Local config (PostgreSQL)
│   │       └── application-docker.yml    # Docker config
│   └── test/                      # Test classes
├── docker-compose.yml             # Multi-service setup
├── Dockerfile                     # Application container
└── pom.xml                       # Maven dependencies
```

## 🗄️ Data Model

### Task Entity (PostgreSQL)
- `id`: UUID (generated by Hibernate `@UuidGenerator`)
- `title`: string (required)
- `description`: text
- `status`: enum [`TODO`, `IN_PROGRESS`, `DONE`]
- `priority`: enum [`LOW`, `MEDIUM`, `HIGH`, `URGENT`]
- `board_id`: string (required)
- `assigned_to`: string
- `due_date`: timestamp
- `created_at`, `updated_at`: timestamps (auto-managed)

## 🔧 Configuration

### Profiles

- **default**: Local development with localhost connections
- **docker**: Container environment with service names
- **test**: Embedded databases for testing

## 📊 API Endpoints

### Task Management
- `POST /api/tasks` - Create task (returns UUID id)
- `GET /api/tasks/{id}` - Get task by UUID
- `PUT /api/tasks/{id}` - Update task by UUID
- `DELETE /api/tasks/{id}` - Delete task by UUID
- `PUT /api/tasks/{id}/status` - Update task status

### Queries
- `GET /api/tasks/board/{boardId}` - Get tasks by board
- `GET /api/tasks/assignee/{userId}` - Get tasks by assignee
- `GET /api/tasks/status/{status}` - Get tasks by status
- `GET /api/tasks/overdue` - Get overdue tasks

### Cache Management
- `GET /api/cache/stats` - Cache statistics
- `DELETE /api/cache/clear` - Clear all cache
- `DELETE /api/cache/task/{id}` - Evict specific task
- `DELETE /api/cache/board/{id}` - Evict board cache
- `DELETE /api/cache/user/{id}` - Evict user cache

### Performance Monitoring
- `GET /api/metrics/cache` - Cache performance metrics
- `GET /api/metrics/cache/average-times` - Average operation times
- `POST /api/metrics/cache/reset` - Reset metrics

### Kafka Management
- `GET /api/kafka/health` - Kafka health status
- `GET /api/kafka/metrics` - Kafka performance metrics
- `GET /api/kafka/metrics/publish-times` - Average publish times
- `GET /api/kafka/metrics/consumption-times` - Average consumption times
- `POST /api/kafka/metrics/reset` - Reset Kafka metrics
- `GET /api/kafka/info` - Kafka service information

### Health & Monitoring
- `GET /actuator/health` - Application health
- `GET /actuator/info` - Application info
- `GET /actuator/metrics` - Application metrics

## 🐳 Docker Services

### Application Stack
```yaml
services:
  app:           # Spring Boot application (port 8080)
  postgresql:    # PostgreSQL database (port 5432)
  redis:         # Redis cache (port 6379)
  kafka:         # Apache Kafka (port 9092)
  zookeeper:     # Zookeeper for Kafka (port 2181)
```

### Container Features
- **Multi-stage builds** for optimized image size
- **Non-root user** for security
- **Health checks** for container orchestration
- **Persistent volumes** for data
- **Custom networks** for service isolation

## ☁️ Azure Container Apps Deployment

### Free Tier Benefits
- **180,000 vCPU-seconds** monthly
- **360,000 GiB-seconds** monthly
- **2 million requests** monthly
- **Auto-scaling to zero** (cost optimization)

### Deployment Steps
1. **Create Container App Environment**
2. **Deploy from GitHub** (automatic builds)
3. **Configure environment variables**
4. **Set up custom domains** (optional)

### Container Apps Features
- ✅ Serverless scaling
- ✅ Automatic HTTPS
- ✅ Built-in load balancing
- ✅ Blue-green deployments
- ✅ Integrated monitoring

## 🧪 Testing

### Run Tests
```bash
# Unit tests
mvn test

# Cache tests only
mvn test -Dtest=CacheServiceUnitTest

# Kafka tests only
mvn test -Dtest=KafkaServiceUnitTest

# All tests with scripts
# Windows
run-tests.bat

# Linux/Mac
chmod +x run-tests.sh && ./run-tests.sh

# Kafka tests with Docker
# Windows
run-kafka-tests.bat

# Linux/Mac
chmod +x run-kafka-tests.sh && ./run-kafka-tests.sh

# Integration tests with embedded MongoDB
mvn verify

# Test with specific profile
mvn test -Dspring.profiles.active=test
```

### Test Configuration
- **Embedded MongoDB** for integration tests
- **TestContainers** for full stack testing
- **Separate test profiles** for isolation

## 🚀 Development Workflow

### Local Development
1. Start infrastructure: `docker-compose up -d mongodb redis`
2. Run app: `mvn spring-boot:run`
3. Make changes and test
4. Commit and push to trigger CI/CD

### Docker Development
1. Build and start: `docker-compose up --build`
2. Make changes
3. Rebuild: `docker-compose build app`
4. Restart: `docker-compose restart app`

## 📈 Performance Optimizations

### Advanced Caching System

The application implements a sophisticated multi-level caching strategy using Redis:

#### Cache Types & TTLs
- **Individual Tasks**: 1 hour TTL for frequently accessed tasks
- **Task Lists**: 30 minutes TTL for board/user task collections
- **Task Counts**: 15 minutes TTL for dashboard statistics
- **User Tasks**: 45 minutes TTL for user-specific task lists

#### Cache Management Features
- **Smart Eviction**: Automatic cache invalidation on data changes
- **Performance Metrics**: Detailed monitoring of cache hit/miss ratios
- **Administrative APIs**: Full cache management through REST endpoints
- **Statistics Tracking**: Real-time cache performance analytics

#### Usage Examples
```bash
# Get cache statistics
curl http://localhost:8081/api/cache/stats

# Clear specific board cache
curl -X DELETE http://localhost:8081/api/cache/board/board-123

# Get performance metrics
curl http://localhost:8081/api/metrics/cache
```

### MongoDB Indexes
```javascript
// Essential indexes for performance
db.tasks.createIndex({ "board_id": 1, "status": 1 })
db.tasks.createIndex({ "assigned_to": 1, "created_at": -1 })
db.tasks.createIndex({ "due_date": 1, "status": 1 })
```

### Redis Caching
- **Multi-level caching strategy** with different TTLs
- **Task individual caching** (1 hour TTL)
- **Task list caching** (30 minutes TTL)
- **Task count caching** (15 minutes TTL)
- **User task caching** (45 minutes TTL)
- **Intelligent cache eviction** on data changes
- **Cache performance monitoring** with detailed metrics
- **Cache management APIs** for administration

### Event-Driven Messaging System

The application implements a comprehensive event-driven architecture using Apache Kafka:

#### Event Types & Topics
- **Task Events**: Core task lifecycle events (create, update, delete, status change)
- **Notifications**: User notifications and alerts
- **Analytics**: Data for business intelligence and reporting
- **Dead Letter Queue**: Failed message handling

#### Kafka Features
- **Reliable Messaging**: ACKS=all with idempotence for guaranteed delivery
- **Event Processing**: Real-time event consumption and processing
- **Performance Monitoring**: Detailed metrics for publish/consume operations
- **Dead Letter Queue**: Automatic handling of failed messages
- **Batch Operations**: Efficient batch message processing

#### Usage Examples
```bash
# Get Kafka metrics
curl http://localhost:8080/api/kafka/metrics

# Check Kafka health
curl http://localhost:8080/api/kafka/health

# Get service information
curl http://localhost:8080/api/kafka/info
```

### Application Optimizations
- **Lazy loading** for large collections
- **Pagination** for list endpoints
- **Compression** for API responses
- **Connection pooling** for databases

## 🔒 Security Considerations

- **Non-root containers** for reduced attack surface
- **Environment-based secrets** (not hardcoded)
- **Input validation** with Spring Validation
- **HTTPS enforcement** in production
- **Health check endpoints** for monitoring

## 📚 Key Design Decisions

### Why MongoDB over SQL?
- **Document model** fits task management domain
- **Schema flexibility** for evolving requirements
- **Better performance** for read-heavy workloads
- **Natural JSON mapping** for REST APIs

### Why Docker?
- **Environment consistency** across dev/prod
- **Easy dependency management** 
- **Cloud deployment ready**
- **Scalable architecture**

### Why Azure Container Apps?
- **True serverless** containers
- **Free tier** for development
- **Auto-scaling** to zero
- **Integrated with Azure ecosystem**

## 🐛 Troubleshooting

### Common Issues

**MongoDB Connection Failed**
```bash
# Check if MongoDB is running
docker ps | grep mongo

# Start MongoDB
docker-compose up -d mongodb
```

**Redis Connection Failed**
```bash
# Check Redis status
docker logs <redis-container-id>

# Restart Redis
docker-compose restart redis

# Test Redis connection
docker exec -it <redis-container-id> redis-cli ping
```

**Cache Performance Issues**
```bash
# Check cache statistics
curl http://localhost:8081/api/cache/stats

# Check cache metrics
curl http://localhost:8081/api/metrics/cache

# Clear cache if needed
curl -X DELETE http://localhost:8081/api/cache/clear
```

**Application Won't Start**
```bash
# Check logs
docker-compose logs app

# Rebuild application
docker-compose build --no-cache app
```

**Java Version Issues**
```bash
# Verify Java version
java --version

# Should be Java 21
```

## 📖 Further Reading

- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Redis Documentation](https://redis.io/documentation)
- [Azure Container Apps Documentation](https://docs.microsoft.com/en-us/azure/container-apps/)
- [Docker Documentation](https://docs.docker.com/)
- [Caching Implementation Guide](./docs/04-caching-implementation.md) - Detailed caching documentation
- [Kafka Implementation Guide](./docs/05-kafka-implementation.md) - Event-driven messaging documentation
- [DDIA Book](https://dataintensive.net/) - Database design principles

**Built with ❤️ using modern cloud-native technologies**